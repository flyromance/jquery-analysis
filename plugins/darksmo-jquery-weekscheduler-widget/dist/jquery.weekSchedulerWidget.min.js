/*! Week Scheduler Widget - v0.0.4 - 2014-11-20
* http://darksmo.github.io/jquery-weekscheduler-widget/
* Copyright (c) 2014; Licensed MIT */
!function(a){var b="weekSchedulerWidget",c=[],d={EVT_CONFIRM_CLICKED:"onConfirm."+b,EVT_CANCEL_CLICKED:"onCancel."+b,EVT_WEEK_CHANGED:"onWeekSelected."+b},e={setSingleDaySelect:function(b){var c=this,d=c.data("settings"),f=e.getSelection.call(c),g=f.days;return g.length>1&&b&&a.error("One or zero days must be selected when setSingleDaySelect is called. Found "+g.length+" days selected instead."),d.singleDaySelect=b,c.data("settings",d),e._refreshHtml.call(c),e.setDaysWithState.call(c,g),c},setMinutes:function(b){var c=this,d=c.data("settings"),f=e._enumerateMinutes.call(c,d.minutesPrecision),g=a(f).map(function(a,b){return b.number});return-1===g.toArray().indexOf(b)&&a.error("the minute "+b+" is not valid and should be one of "+g.toArray().join(",")),c.find(".weekSchedulerMinuteOption[name!=minute"+b+"]").prop("selected",""),c.find(".weekSchedulerMinuteOption[name=minute"+b+"]").prop("selected","selected"),c},setHour:function(a){var b=this;return b.find(".weekSchedulerHourOption[name!=hour"+a+"]").prop("selected",""),b.find(".weekSchedulerHourOption[name=hour"+a+"]").prop("selected","selected"),b},setWeek:function(a){var b=this,c=e._getWeekOfDay.call(b,a),d=c[0].getTime()+"-"+c[1].getTime();return b.find("option[value!="+d+"]").prop("selected",""),b.find("option[value="+d+"]").prop("selected","selected"),b},setDays:function(b){var c=this,d=c.data("settings");d.singleDaySelect===!0&&b.length>1&&a.error("Only one day can be selected if the singleDaySelect option is set to true");var f,g=[];for(f=0;f<b.length;f++)g.push({day:b[f],state:"checked"});return e.setDaysWithState.call(c,g),c},setDaysWithState:function(b){var c,d,e,f,g=this,h={0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1},i={0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1};for(c=0;c<b.length;c++)f=b[c],d=f.day,e=f.state,"indeterminate"!==e&&"checked"!==e&&a.error('"'+e+'" is an invalid state. Use "checked" or "indeterminate" instead.'),i[d]=!0,h[d]||"checked"!==e||(h[d]=!0);var j;for(j in i)if(i.hasOwnProperty(j)){var k=g.find("input[value="+j+"]");i[j]?h[j]?(k.prop("checked",!0),k.prop("indeterminate",!1)):(k.prop("indeterminate",!0),k.prop("checked",!1)):(k.prop("checked",!1),k.prop("indeterminate",!1))}return g},setSelectionWithState:function(a){var b=this;return e.setWeek.call(b,a.week[0]),e.setDaysWithState.call(b,a.days),e.setHour.call(b,a.hour),e.setMinutes.call(b,a.minutes),b},setSelection:function(a){var b,c=this,d=a.days,f=[];for(b=0;b<d.length;b++)f.push({day:d[b],state:"checked"});return a.days=f,e.setSelectionWithState.call(c,a),c},getSelection:function(){var b=this,c=[];return a("input[name=days]").each(function(){var b=a(this);(b.prop("checked")===!0||b.prop("indeterminate")===!0)&&c.push({day:parseInt(b.val(),10),state:b.prop("checked")?"checked":"indeterminate"})}),{week:b.find(".weekSchedulerWidgetWeeksSelect").val().split("-").map(function(a){return new Date(parseInt(a,10))}),days:c,hour:b.find(".weekSchedulerWidgetHourSelect").val(),minutes:b.find(".weekSchedulerWidgetMinutesSelect").val()}},_getSelectedDates:function(a){var b,d,e,f=[],g=a.days.length;for(b=0;g>b;b++){e=a.days[b].day,d=a.days[b].state;var h=new Date(a.week[0]);h.setDate(h.getDate()+c.indexOf(e)),h.setHours(a.hour),h.setMinutes(a.minutes),f.push({date:h,state:d})}return f},getSelectedDates:function(){var a=this,b=e.getSelection.call(a);return e._getSelectedDates.call(a,b)},setDates:function(a){var b,c=this,d=[];for(b=0;b<a.length;b++)d.push({date:a[b],state:"checked"});e.setDatesWithState.call(c,d)},setDatesWithState:function(b){var c,d,f,g,h,i,j,k,l,m,n,o=this,p=[];for(n=0;j=b[n++];)k=j.date,l=j.state,g=k.getHours(),h=k.getMinutes(),i=e._getWeekOfDay.call(o,k),p.push({day:k.getDay(),state:l}),"undefined"==typeof f?(f=i,d=h,c=g):((f[0].getTime()!==i[0].getTime()||f[1].getTime()!==i[1].getTime())&&a.error("cannot use this dateset because not all the dates fall in the same week range"),d!==h&&a.error("cannot use this dateset because not all the dates are set to the same minute"),c!==g&&a.error("cannot use this dateset because not all the dates are set to the same hour")),m=k;return e.setSelectionWithState.call(o,{week:[m,m],days:p,hour:g,minutes:h}),o},show:function(){var a=this,b=a.data("settings");if("block"!==a.css("display")&&"inline"!==a.css("display"))return b.onBeforeShow.call(a)&&a.show(),b.onAfterShow.call(a),a},hide:function(a){var b=this,c=b.data("settings");if("none"!==b.css("display")){a="undefined"==typeof a?!0:a;var d=!0;return a&&!c.onBeforeHide.call(b)&&(d=!1),d&&b.hide(),a&&c.onAfterHide.call(b),b}},_buildDayMapping:function(b,c){var d=[];c!==b-1&&a.error("Invalid indices, must be end = start - 1"),(c>=7||0>c)&&a.error("Invalid endDay index, must be between 0 and 6"),(b>=7||0>b)&&a.error("Invalid startDay index, must be between 0 and 6");for(var e=b;e!==c;)d.push(e++),7===e&&(e=0);return d.push(e++),d},_bindEvents:function(){var b=this;b.find(".weekSchedulerWidgetWeeksSelect").bind("change",function(){b.trigger(a.Event(d.EVT_WEEK_CHANGED))}),b.bind("click",function(c){if("undefined"!=typeof c.target){var e=a(c.target);e.hasClass("weekSchedulerWidgetButtonCancel")?b.trigger(a.Event(d.EVT_CANCEL_CLICKED)):e.hasClass("weekSchedulerWidgetButtonConfirm")&&b.trigger(a.Event(d.EVT_CONFIRM_CLICKED))}})},_enumerateMinutes:function(a){var b,c=[];for(b=0;60>b;b+=a)c.push({number:60===b?0:b,string:("00"+b).slice(-2)});return c},_getMinutesMarkup:function(a){var b=this,c=[];c.push('<select class="weekSchedulerWidgetMinutesSelect">');var d,f,g=e._enumerateMinutes.call(b,a);for(d=0;f=g[d++];)c.push(['<option class="weekSchedulerMinuteOption" name="minute',f.number,'" value="',f.number,'">',f.string,"</option>"].join(""));return c.push("</select>"),c.join("")},_getHoursMarkup:function(){var a,b=['<select class="weekSchedulerWidgetHourSelect">'];for(a=1;24>a;a++)b.push(['<option class="weekSchedulerHourOption" name="hour',a,'" value="',a,'">',("00"+a).slice(-2),"</option>"].join(""));return b.push('<option name="hour0" value="0">00</option>'),b.push("</select>"),b.join("")},_getDaysMarkup:function(){var a,b,d=this,e=d.data("settings"),f=e.singleDaySelect?"radio":"checkbox",g=[];for(a=0;b=e.localization.dayNames[a];a++)g.push(['<div class="weekSchedulerWidgetDay">','<input id="weekSchedulerWidgetDay'+e.localization.dayNames[a]+'" type="'+f+'" name="days" value="',c[a],'" />','<label for="weekSchedulerWidgetDay'+b+'" class="weekSchedulerWidgetDayName">',b,"</label>","</div>"].join(""));return g.join("")},_getWeekOfDay:function(b){var c=this,d=c.data("settings");"undefined"==typeof b&&a.error("_getWeekOfDay: dayDate parameter must be not null");var e=function(a,b,c){for(var d=new Date(a);d.getDay()!==c;)d.setDate(d.getDate()+b);return d},f=new Date(b.getFullYear(),b.getMonth(),b.getDate()),g=e(f,-1,d.firstDayOfWeek),h=e(f,1,d.lastDayOfWeek);return g.setHours(0),g.setMinutes(0),g.setSeconds(0),h.setHours(23),h.setMinutes(59),h.setSeconds(59),[g,h]},_getWeeksMarkup:function(a,b){var c,d=this,f=d.data("settings"),g=['<select class="weekSchedulerWidgetWeeksSelect">'],h=new Date(a),i=e._getWeekOfDay.call(d,b);do c=e._getWeekOfDay.call(d,h),g.push(['<option value="',c[0].getTime()+"-"+c[1].getTime(),'">',c[0].getDate()," ",f.localization.monthNames[c[0].getMonth()]," ",c[0].getFullYear()," ",f.localization.to," ",c[1].getDate()," ",f.localization.monthNames[c[1].getMonth()]," ",c[1].getFullYear(),"</option>"].join("")),h.setDate(h.getDate()+7);while(c[0].getTime()!==i[0].getTime()&&c[1].getTime()!==i[1].getTime());return g.push("</select>"),g.join("")},_getWidgetHtml:function(){var a=this,b=a.data("settings"),c=['<div class="weekSchedulerWidgetContainer">','<span class="weekSchedulerWidgetTitle">',b.localization.title,"</span>",'<div class="weekSchedulerWidgetLabel">',b.localization.week,"</div>",e._getWeeksMarkup.call(a,b.startDate,b.endDate),'<div class="weekSchedulerWidgetLabel">',b.localization.days,"</div>",e._getDaysMarkup.call(a),'<div class="weekSchedulerWidgetClearfix"></div>','<div class="weekSchedulerWidgetLabel">',b.localization.time,"</div>",'<div class="weekSchedulerWidgetLayoutHorizontal">','<div class="weekSchedulerWidgetHour">','<div class="weekSchedulerWidgetSubLabel">',b.localization.hour,"</div>",e._getHoursMarkup.call(a),"</div>",'<div class="weekSchedulerWidgetMinute">','<div class="weekSchedulerWidgetSubLabel">',b.localization.minute,"</div>",e._getMinutesMarkup.call(a,b.minutesPrecision),"</div>","</div>",'<div class="weekSchedulerWidgetClearfix"></div>','<div class="weekSchedulerWidgetLayoutHorizontalRight">','<div class="weekSchedulerWidgetButton weekSchedulerWidgetButtonConfirm">',b.localization.confirm,"</div>",'<div class="weekSchedulerWidgetButton weekSchedulerWidgetButtonCancel">',b.localization.cancel,"</div>","</div>",'<div class="weekSchedulerWidgetClearfix"></div>',"</div>"].join("");return c},_validateMonthNames:function(b){return 12!==b.length&&a.error("You need to provide exactly 12 months in localization.monthNames. Got "+b.length+" months instead"),!0},_validateMinutesPrecision:function(b){return"number"!=typeof b&&a.error("please provide a number for the minutesPrecision option"),0>=b&&a.error("the minutesPrecision parameter must be >= 1 and <= 30"),!0},_refreshHtml:function(){var a=this,b=e._getWidgetHtml.call(a);return a.html(b),a},destroy:function(){var a=this;return a.unbind("click"),a.find(".weekSchedulerWidgetWeeksSelect").unbind("change"),a.html(""),c=[],a},init:function(b){var d=a.extend({localization:{title:"Schedule item",week:"Week",days:"Days",time:"Time",hour:"Hour",minute:"Minute",confirm:"Add",cancel:"Cancel",to:"to",dayNames:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]},singleDaySelect:!1,minutesPrecision:15,startDate:new Date,endDate:function(){var a=new Date;return a.setMonth(a.getMonth()+1),a}(),firstDayOfWeek:1,lastDayOfWeek:0,hideOnStart:!1,onBeforeShow:function(){return!0},onAfterShow:function(){},onBeforeHide:function(){return!0},onAfterHide:function(){}},b);return e._validateMonthNames(d.localization.monthNames),e._validateMinutesPrecision(d.minutesPrecision),c=e._buildDayMapping(d.firstDayOfWeek,d.lastDayOfWeek),this.each(function(){var b=a(this);if(b.data("settings",d),d.hideOnStart){var c=!1;e.hide.call(b,c)}e._refreshHtml.call(b),e._bindEvents.call(b)})}};a.fn[b]=function(c){if(e[c]){if(this.data("initialized")===!0)return e[c].apply(this,Array.prototype.slice.call(arguments,1));throw new Error("method "+c+" called on an uninitialized instance of "+b)}return"object"!=typeof c&&c?void a.error("Cannot call method "+c):(this.data("initialized",!0),e.init.apply(this,arguments))}}(jQuery);